!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ionSdk=t():e.ionSdk=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=48)}([function(e,t,r){var n=r(27)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},function(e,t){function r(e,t,r,n,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,o)}e.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var s=e.apply(t,n);function a(e){r(s,o,i,a,c,"next",e)}function c(e){r(s,o,i,a,c,"throw",e)}a(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(15);function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,n(o.key),o)}}e.exports=function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";const n={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},n.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},n.getDescription=function(e){const t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){const t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(e=>0===e.indexOf(t))},n.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const r={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":r.relatedAddress=t[e+1];break;case"rport":r.relatedPort=parseInt(t[e+1],10);break;case"tcptype":r.tcpType=t[e+1];break;case"ufrag":r.ufrag=t[e+1],r.usernameFragment=t[e+1];break;default:void 0===r[t[e]]&&(r[t[e]]=t[e+1])}return r},n.writeCandidate=function(e){const t=[];t.push(e.foundation);const r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substring(14).split(" ")},n.parseRtpMap=function(e){let t=e.substring(9).split(" ");const r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},n.parseFmtp=function(e){const t={};let r;const n=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<n.length;e++)r=n[e].trim().split("="),t[r[0].trim()]=r[1];return t},n.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){const t=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,t),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substring(t+1,n),r.value=e.substring(n+1)):r.attribute=e.substring(t+1),r},n.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},n.getMid=function(e){const t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substring(6)},n.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},n.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?n.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},n.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},n.getCryptoParameters=function(e,t){return n.matchPrefix(e+t,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(e,t){const r=n.matchPrefix(e+t,"a=ice-ufrag:")[0],o=n.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},n.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},n.parseRtpParameters=function(e){const t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(" ");t.profile=r[2];for(let o=3;o<r.length;o++){const i=r[o],s=n.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(s){const r=n.parseRtpMap(s),o=n.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=o.length?n.parseFmtp(o[0]):{},r.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(n.parseRtcpFb),t.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(r.name.toUpperCase())}}}n.matchPrefix(e,"a=extmap:").forEach(e=>{t.headerExtensions.push(n.parseExtmap(e))});const o=n.matchPrefix(e,"a=rtcp-fb:* ").map(n.parseRtcpFb);return t.codecs.forEach(e=>{o.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),t},n.writeRtpDescription=function(e,t){let r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" "+(t.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=t.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(e=>{r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});let o=0;return t.codecs.forEach(e=>{e.maxptime>o&&(o=e.maxptime)}),o>0&&(r+="a=maxptime:"+o+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach(e=>{r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){const t=[],r=n.parseRtpParameters(e),o=-1!==r.fecMechanisms.indexOf("RED"),i=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=n.matchPrefix(e,"a=ssrc:").map(e=>n.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),a=s.length>0&&s[0].ssrc;let c;const u=n.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));u.length>0&&u[0].length>1&&u[0][0]===a&&(c=u[0][1]),r.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let r={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(r.rtx={ssrc:c}),t.push(r),o&&(r=JSON.parse(JSON.stringify(r)),r.fec={ssrc:a,mechanism:i?"red+ulpfec":"red"},t.push(r))}}),0===t.length&&a&&t.push({ssrc:a});let d=n.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,t.forEach(e=>{e.maxBitrate=d})),t},n.parseRtcpParameters=function(e){const t={},r=n.matchPrefix(e,"a=ssrc:").map(e=>n.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);const o=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=o.length>0,t.compound=0===o.length;const i=n.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},n.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},n.parseMsid=function(e){let t;const r=n.matchPrefix(e,"a=msid:");if(1===r.length)return t=r[0].substring(7).split(" "),{stream:t[0],track:t[1]};const o=n.matchPrefix(e,"a=ssrc:").map(e=>n.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return o.length>0?(t=o[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},n.parseSctpDescription=function(e){const t=n.parseMLine(e),r=n.matchPrefix(e,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const i=n.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substring(12),10),protocol:t.fmt,maxMessageSize:o};const s=n.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:o}}},n.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(e,t,r){let o;const i=void 0!==t?t:2;o=e||n.generateSessionId();return"v=0\r\no="+(r||"thisisadapterortc")+" "+o+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.getDirection=function(e,t){const r=n.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substring(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substring(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){const t=n.splitLines(e)[0].substring(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){const t=n.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const t=n.splitLines(e);for(let e=0;e<t.length;e++)if(t[e].length<2||"="!==t[e].charAt(1))return!1;return!0},e.exports=n},function(e,t){function r(t){return e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(20),o=r(21),i=r(22),s=r(24);e.exports=function(e,t){return n(e)||o(e,t)||i(e,t)||s()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";var n,o="object"==typeof Reflect?Reflect:null,i=o&&"function"==typeof o.apply?o.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(r,n){function o(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),r([].slice.call(arguments))}g(e,t,i,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&g(e,"error",t,r)}(e,o,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function p(e,t,r,n){var o,i,s,a;if(u(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),s=i[t]),void 0===s)s=i[t]=r,++e._eventsCount;else if("function"==typeof s?s=i[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(o=d(e))>0&&s.length>o&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=l.bind(n);return o.listener=r,n.wrapFn=o,o}function h(e,t,r){var n=e._events;if(void 0===n)return[];var o=n[t];return void 0===o?[]:"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):v(o,o.length)}function m(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function v(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function g(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(i){n.once&&e.removeEventListener(t,o),r(i)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return d(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var u=c.length,d=v(c,u);for(r=0;r<u;++r)i(d[r],this,t)}return!0},a.prototype.addListener=function(e,t){return p(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return p(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,o,i,s;if(u(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){s=r[i].listener,o=i;break}if(o<0)return this;0===o?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,o),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var o,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(o=i[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return h(this,e,!0)},a.prototype.rawListeners=function(e){return h(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){const n=r(30),o="protoo-client";e.exports=class{constructor(e){e?(this._debug=n(`${o}:${e}`),this._warn=n(`${o}:WARN:${e}`),this._error=n(`${o}:ERROR:${e}`)):(this._debug=n(o),this._warn=n(o+":WARN"),this._error=n(o+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},function(e,t,r){var n=r(15);e.exports=function(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(25);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(8).default,o=r(26);e.exports=function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return o(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){const{version:n}=r(28),o=r(29),i=r(35);t.version=n,t.Peer=o,t.WebSocketTransport=i},function(e,t,r){var n=r(46),o=r(47);t.write=o,t.parse=n.parse,t.parseParams=n.parseParams,t.parseFmtpConfig=n.parseFmtpConfig,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t,r){var n=r(8).default,o=r(19);e.exports=function(e){var t=o(e,"string");return"symbol"===n(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){const{EventEmitter:n}=r(7),o=r(9);e.exports=class extends n{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new o("EnhancedEventEmitter")}safeEmit(e,...t){try{this.emit(e,...t)}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}async safeEmitAsPromise(e,...t){return new Promise((r,n)=>{this.safeEmit(e,...t,r,n)})}}},function(e,t,r){const n=r(9),{generateRandomNumber:o}=r(34),i=new n("Message");e.exports=class{static parse(e){let t;const r={};try{t=JSON.parse(e)}catch(e){return void i.error("parse() | invalid JSON: %s",e)}if("object"==typeof t&&!Array.isArray(t)){if(t.request){if(r.request=!0,"string"!=typeof t.method)return void i.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void i.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void i.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void i.error("parse() | missing request/response field");if(r.notification=!0,"string"!=typeof t.method)return void i.error("parse() | missing/invalid method field");r.method=t.method,r.data=t.data||{}}return r}i.error("parse() | not an object")}static createRequest(e,t){return{request:!0,id:o(),method:e,data:t||{}}}static createSuccessResponse(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}static createErrorResponse(e,t,r){return{response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r}}static createNotification(e,t){return{notification:!0,method:e,data:t||{}}}}},function(e,t){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach((function(e){r[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},function(e,t,r){var n=r(8).default;e.exports=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,s,a=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw o}}return a}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(23);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function r(t,n){return e.exports=r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t,n)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(8).default;function o(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e.exports=o=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},r=Object.prototype,i=r.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",d=a.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),a=new E(n||[]);return s(i,"_invoke",{value:x(e,r,a)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h={};function m(){}function v(){}function g(){}var y={};p(y,c,(function(){return this}));var b=Object.getPrototypeOf,_=b&&b(b(P([])));_&&_!==r&&i.call(_,c)&&(y=_);var C=g.prototype=m.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){var r;s(this,"_invoke",{value:function(o,s){function a(){return new t((function(r,a){!function r(o,s,a,c){var u=f(e[o],e,s);if("throw"!==u.type){var d=u.arg,p=d.value;return p&&"object"==n(p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,a,c)}),(function(e){r("throw",e,a,c)})):t.resolve(p).then((function(e){d.value=e,a(d)}),(function(e){return r("throw",e,a,c)}))}c(u.arg)}(o,s,r,a)}))}return r=r?r.then(a,a):a()}})}function x(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return O()}for(r.method=o,r.arg=i;;){var s=r.delegate;if(s){var a=T(s,r);if(a){if(a===h)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=f(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function T(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var o=f(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,h;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function P(e){if(e){var t=e[c];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:O}}function O(){return{value:void 0,done:!0}}return v.prototype=g,s(C,"constructor",{value:g,configurable:!0}),s(g,"constructor",{value:v,configurable:!0}),v.displayName=p(g,d,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,p(e,d,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},w(S.prototype),p(S.prototype,u,(function(){return this})),t.AsyncIterator=S,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var s=new S(l(e,r,n,o),i);return t.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},w(C),p(C,d,"Generator"),p(C,c,(function(){return this})),p(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=P,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var a=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},function(e){e.exports=JSON.parse('{"name":"protoo-client","version":"4.0.6","description":"protoo JavaScript client module","author":"IÃ±aki Baz Castillo <ibc@aliax.net>","homepage":"https://protoo.versatica.com","license":"MIT","repository":{"type":"git","url":"https://github.com/ibc/protoo.git"},"main":"lib/index.js","keywords":["nodejs","browser","websocket"],"engines":{"node":">=8.0.0"},"scripts":{"lint":"eslint -c .eslintrc.js lib"},"dependencies":{"debug":"^4.3.1","events":"^3.2.0","retry":"^0.12.0"},"devDependencies":{"eslint":"^5.16.0"},"optionalDependencies":{"websocket":"^1.0.33"}}')},function(e,t,r){const n=r(9),o=r(16),i=r(17),s=new n("Peer");e.exports=class extends o{constructor(e){super(s),s.debug("constructor()"),this._closed=!1,this._transport=e,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){s.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const e of this._sents.values())e.close();this.safeEmit("close")}}async request(e,t){const r=i.createRequest(e,t);return this._logger.debug("request() [method:%s, id:%s]",e,r.id),await this._transport.send(r),new Promise((e,t)=>{const n=1500*(15+.1*this._sents.size),o={id:r.id,method:r.method,resolve:t=>{this._sents.delete(r.id)&&(clearTimeout(o.timer),e(t))},reject:e=>{this._sents.delete(r.id)&&(clearTimeout(o.timer),t(e))},timer:setTimeout(()=>{this._sents.delete(r.id)&&t(new Error("request timeout"))},n),close:()=>{clearTimeout(o.timer),t(new Error("peer closed"))}};this._sents.set(r.id,o)})}async notify(e,t){const r=i.createNotification(e,t);this._logger.debug("notify() [method:%s]",e),await this._transport.send(r)}_handleTransport(){if(this._transport.closed)return this._closed=!0,void setTimeout(()=>{this._closed||(this._connected=!1,this.safeEmit("close"))});this._transport.on("open",()=>{this._closed||(s.debug('emit "open"'),this._connected=!0,this.safeEmit("open"))}),this._transport.on("disconnected",()=>{this._closed||(s.debug('emit "disconnected"'),this._connected=!1,this.safeEmit("disconnected"))}),this._transport.on("failed",e=>{this._closed||(s.debug('emit "failed" [currentAttempt:%s]',e),this._connected=!1,this.safeEmit("failed",e))}),this._transport.on("close",()=>{this._closed||(this._closed=!0,s.debug('emit "close"'),this._connected=!1,this.safeEmit("close"))}),this._transport.on("message",e=>{e.request?this._handleRequest(e):e.response?this._handleResponse(e):e.notification&&this._handleNotification(e)})}_handleRequest(e){try{this.emit("request",e,t=>{const r=i.createSuccessResponse(e,t);this._transport.send(r).catch(()=>{})},(t,r)=>{t instanceof Error?(r=t.message,t=500):"number"==typeof t&&r instanceof Error&&(r=r.message);const n=i.createErrorResponse(e,t,r);this._transport.send(n).catch(()=>{})})}catch(t){const r=i.createErrorResponse(e,500,String(t));this._transport.send(r).catch(()=>{})}}_handleResponse(e){const t=this._sents.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{const r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else s.error("received response does not match any sent request [id:%s]",e.id)}_handleNotification(e){this.safeEmit("notification",e)}}},function(e,t,r){(function(n){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,o=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(o=n))}),t.splice(o,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(32)(t);const{formatters:o}=e.exports;o.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(31))},function(e,t){var r,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,u=[],d=!1,p=-1;function l(){d&&c&&(d=!1,c.length?u=c.concat(u):p=-1,u.length&&f())}function f(){if(!d){var e=a(l);d=!0;for(var t=u.length;t;){for(c=u,u=[];++p<t;)c&&c[p].run();p=-1,t=u.length}c=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new h(e,t)),1!==u.length||d||a(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,r){e.exports=function(e){function t(e){let r,o,i,s=null;function a(...e){if(!a.enabled)return;const n=a,o=Number(new Date),i=o-(r||o);n.diff=i,n.prev=r,n.curr=o,r=o,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,o)=>{if("%%"===r)return"%";s++;const i=t.formatters[o];if("function"==typeof i){const t=e[s];r=i.call(n,t),e.splice(s,1),s--}return r}),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(o!==t.namespaces&&(o=t.namespaces,i=t.enabled(e)),i),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(o),...t.skips.map(o).map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(r=0;r<o;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(33),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(r=>{t[r]=e[r]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},function(e,t){var r=1e3,n=6e4,o=60*n,i=24*o;function s(e,t,r,n){var o=t>=1.5*r;return Math.round(e/r)+" "+n+(o?"s":"")}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*o;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(e);if("number"===a&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return s(e,t,i,"day");if(t>=o)return s(e,t,o,"hour");if(t>=n)return s(e,t,n,"minute");if(t>=r)return s(e,t,r,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=o)return Math.round(e/o)+"h";if(t>=n)return Math.round(e/n)+"m";if(t>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t){t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},function(e,t,r){const n=r(36).w3cwebsocket,o=r(40),i=r(9),s=r(16),a=r(17),c={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},u=new i("WebSocketTransport");e.exports=class extends s{constructor(e,t){super(u),u.debug("constructor() [url:%s, options:%o]",e,t),this._closed=!1,this._url=e,this._options=t||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){u.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){u.error("close() | error closing the WebSocket: %o",e)}}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(e){throw u.warn("send() failed:%o",e),e}}_runWebSocket(){const e=o.operation(this._options.retry||c);let t=!1;e.attempt(r=>{this._closed?e.stop():(u.debug("_runWebSocket() [currentAttempt:%s]",r),this._ws=new n(this._url,void 0,this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(t=!0,this.safeEmit("open"))},this._ws.onclose=n=>{if(!this._closed){if(u.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',n.wasClean,n.code,n.reason),4e3!==n.code){if(t){if(e.stop(),this.safeEmit("disconnected"),this._closed)return;return void this._runWebSocket()}if(this.safeEmit("failed",r),this._closed)return;if(e.retry(!0))return}this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||u.error('WebSocket "error" event')},this._ws.onmessage=e=>{if(this._closed)return;const t=a.parse(e.data);t&&(0!==this.listenerCount("message")?this.safeEmit("message",t):u.error('no listeners for WebSocket "message" event, ignoring received message'))})})}}},function(e,t,r){var n;if("object"==typeof globalThis)n=globalThis;else try{n=r(37)}catch(e){}finally{if(n||"undefined"==typeof window||(n=window),!n)throw new Error("Could not determine global this")}var o=n.WebSocket||n.MozWebSocket,i=r(38);function s(e,t){return t?new o(e,t):new o(e)}o&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(s,e,{get:function(){return o[e]}})})),e.exports={w3cwebsocket:o?s:null,version:i}},function(e,t){var r=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return r()}try{return __global__||r()}finally{delete Object.prototype.__global__}}()},function(e,t,r){e.exports=r(39).version},function(e){e.exports=JSON.parse('{"name":"websocket","description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"author":"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)","contributors":["IÃ±aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],"version":"1.0.34","repository":{"type":"git","url":"https://github.com/theturtle32/WebSocket-Node.git"},"homepage":"https://github.com/theturtle32/WebSocket-Node","engines":{"node":">=4.0.0"},"dependencies":{"bufferutil":"^4.0.1","debug":"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2","yaeti":"^0.0.6"},"devDependencies":{"buffer-equal":"^1.0.0","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1","jshint":"^2.0.0","tape":"^4.9.1"},"config":{"verbose":false},"scripts":{"test":"tape test/unit/*.js","gulp":"gulp"},"main":"index","directories":{"lib":"./lib"},"browser":"lib/browser.js","license":"Apache-2.0"}')},function(e,t,r){e.exports=r(41)},function(e,t,r){var n=r(42);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],o=0;o<t.retries;o++)n.push(this.createTimeout(o,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(o,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return n=Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var o in n=[],e)"function"==typeof e[o]&&n.push(o);for(var i=0;i<n.length;i++){var s=n[i],a=e[s];e[s]=function(n){var o=t.operation(r),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push((function(e){o.retry(e)||(e&&(arguments[0]=o.mainError()),s.apply(this,arguments))})),o.attempt((function(){n.apply(e,i)}))}.bind(e,a),e[s].options=r}}},function(e,t){function r(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,o=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&o.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var o=this._errors[n],i=o.message,s=(e[i]||0)+1;e[i]=s,s>=r&&(t=o,r=s)}return t}},function(e,t,r){var n=r(44),o=r(45);e.exports=function(e,t,r){var i=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[i+a]=s[a];return t||o(s)}},function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,o=r;return[o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]]].join("")}},function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,r){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:o?t[e.name]:t;!function(e,t,r,o){if(o&&!r)t[o]=n(e[1]);else for(var i=0;i<r.length;i+=1)null!=e[i+1]&&(t[r[i]]=n(e[i+1]))}(r.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},i=r(18),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach((function(e){var t=e[0],s=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var a=0;a<(i[t]||[]).length;a+=1){var c=i[t][a];if(c.reg.test(s))return o(c,n,s)}})),t.media=r,t};var a=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),o=0;o<r.length;o+=3)t.push({component:r[o],ip:r[o+1],port:r[o+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},function(e,t,r){var n=r(18),o=/%[sdv%]/g,i=function(e){var t=1,r=arguments,n=r.length;return e.replace(o,(function(e){if(t>=n)return e;var o=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}}))},s=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var s=t.names[o];t.name?n.push(r[t.name][s]):n.push(r[t.names[o]])}else n.push(r[t.name]);return i.apply(null,n)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||a,o=t.innerOrder||c,i=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(s(t,r,e))}))}))})),e.media.forEach((function(e){i.push(s("m",n.m[0],e)),o.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(s(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"}},function(e,t,r){"use strict";r.r(t),r.d(t,"Client",(function(){return it})),r.d(t,"Stream",(function(){return Be})),r.d(t,"Utils",(function(){return a})),r.d(t,"Enum",(function(){return c}));var n={};r.r(n),r.d(n,"shimGetUserMedia",(function(){return G})),r.d(n,"shimGetDisplayMedia",(function(){return q})),r.d(n,"shimMediaStream",(function(){return W})),r.d(n,"shimOnTrack",(function(){return $})),r.d(n,"shimGetSendersWithDtmf",(function(){return B})),r.d(n,"shimGetStats",(function(){return K})),r.d(n,"shimSenderReceiverGetStats",(function(){return H})),r.d(n,"shimAddTrackRemoveTrackWithNative",(function(){return Z})),r.d(n,"shimAddTrackRemoveTrack",(function(){return Y})),r.d(n,"shimPeerConnection",(function(){return X})),r.d(n,"fixNegotiationNeeded",(function(){return Q}));var o={};r.r(o),r.d(o,"shimGetUserMedia",(function(){return ee})),r.d(o,"shimGetDisplayMedia",(function(){return te})),r.d(o,"shimOnTrack",(function(){return re})),r.d(o,"shimPeerConnection",(function(){return ne})),r.d(o,"shimSenderGetStats",(function(){return oe})),r.d(o,"shimReceiverGetStats",(function(){return ie})),r.d(o,"shimRemoveStream",(function(){return se})),r.d(o,"shimRTCDataChannel",(function(){return ae})),r.d(o,"shimAddTransceiver",(function(){return ce})),r.d(o,"shimGetParameters",(function(){return ue})),r.d(o,"shimCreateOffer",(function(){return de})),r.d(o,"shimCreateAnswer",(function(){return pe}));var i={};r.r(i),r.d(i,"shimLocalStreamsAPI",(function(){return le})),r.d(i,"shimRemoteStreamsAPI",(function(){return fe})),r.d(i,"shimCallbacksAPI",(function(){return he})),r.d(i,"shimGetUserMedia",(function(){return me})),r.d(i,"shimConstraints",(function(){return ve})),r.d(i,"shimRTCIceServerUrls",(function(){return ge})),r.d(i,"shimTrackEventTransceiver",(function(){return ye})),r.d(i,"shimCreateOfferLegacy",(function(){return be})),r.d(i,"shimAudioContext",(function(){return _e}));var s={};r.r(s),r.d(s,"shimRTCIceCandidate",(function(){return Se})),r.d(s,"shimRTCIceCandidateRelayProtocol",(function(){return xe})),r.d(s,"shimMaxMessageSize",(function(){return Te})),r.d(s,"shimSendThrowTypeError",(function(){return ke})),r.d(s,"shimConnectionState",(function(){return Re})),r.d(s,"removeExtmapAllowMixed",(function(){return Ee})),r.d(s,"shimAddIceCandidateNullOrEmpty",(function(){return Pe})),r.d(s,"shimParameterlessSetLocalDescription",(function(){return Oe}));var a={};r.r(a),r.d(a,"getBrowerDetail",(function(){return Me})),r.d(a,"checkSupportWebRtc",(function(){return Le})),r.d(a,"getMediaDevices",(function(){return Ne}));var c={};r.r(c),r.d(c,"FrameRateEnum",(function(){return Ae})),r.d(c,"VideoResolutionEnum",(function(){return Fe}));var u=r(10),d=r.n(u),p=r(6),l=r.n(p),f=r(1),h=r.n(f),m=r(2),v=r.n(m),g=r(3),y=r.n(g),b=r(11),_=r.n(b),C=r(12),w=r.n(C),S=r(5),x=r.n(S),T=r(0),k=r.n(T),R=r(7),E=r(13),P=r.n(E),O=(r(43),function(){function e(){v()(this,e),this._parentElementId=null,this._video=null}return y()(e,[{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:id,stream:stream,elementId:elementId,remote:!1},t=document.createElement("video");t.autoplay=!0,t.playsinline=!0,t.controls=!0,t.muted=!e.remote,t.srcObject=e.stream,t.id="stream".concat(e.id);var r=document.getElementById(e.elementId);r.appendChild(t),this.parentElement=r,this._video=t,this._parentElementId=e.elementId}},{key:"parentElementId",get:function(){return this._parentElementId}},{key:"stop",value:function(){this._video&&(this._video.pause(),this.parentElement.removeChild(this._video),this._parentElementId=null)}}]),e}());let I=!0,j=!0;function D(e,t,r){const n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function M(e,t,r){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,o=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return o.apply(this,arguments);const i=e=>{const t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,i),o.apply(this,[e,i])};const i=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(r))return i.apply(this,arguments);const n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,i.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function L(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(I=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function N(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(j=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function A(){if("object"==typeof window){if(I)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function F(e,t){j&&console.warn(e+" is deprecated, please use "+t+" instead.")}function U(e){return"[object Object]"===Object.prototype.toString.call(e)}function z(e){return U(e)?Object.keys(e).reduce((function(t,r){const n=U(e[r]),o=n?z(e[r]):e[r],i=n&&!Object.keys(o).length;return void 0===o||i?t:Object.assign(t,{[r]:o})}),{}):e}function V(e,t,r){const n=r?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;const i=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)}),i.forEach(t=>{e.forEach(r=>{r.type===n&&r.trackId===t.id&&function e(t,r,n){r&&!n.has(r.id)&&(n.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?e(t,t.get(r[o]),n):o.endsWith("Ids")&&r[o].forEach(r=>{e(t,t.get(r),n)})}))}(e,r,o)})}),o}const J=A;function G(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;const n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);const o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"==typeof n.ideal?(e[o("min",r)]=n.ideal,t.optional.push(e),e={},e[o("max",r)]=n.ideal,t.optional.push(e)):(e[o("",r)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",r)]=n.exact):["min","max"].forEach(e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,r)]=n[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,o){if(t.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){let i=e.video.facingMode;i=i&&("object"==typeof i?i:{ideal:i});const s=t.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===i.exact||"environment"===i.ideal?t=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(t=["front"]),t)return r.mediaDevices.enumerateDevices().then(r=>{let s=(r=r.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!s&&r.length&&t.includes("back")&&(s=r[r.length-1]),s&&(e.video.deviceId=i.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=n(e.video),J("chrome: "+JSON.stringify(e)),o(e)})}e.video=n(e.video)}return J("chrome: "+JSON.stringify(e)),o(e)},i=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,n){o(e,e=>{r.webkitGetUserMedia(e,t,e=>{n&&n(i(e))})})}.bind(r),r.mediaDevices.getUserMedia){const e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return o(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(i(e))))}}}function q(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(t=>{const n=r.video&&r.video.width,o=r.video&&r.video.height,i=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}},n&&(r.video.mandatory.maxWidth=n),o&&(r.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function W(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function $(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===r.track.id):{track:r.track};const o=new Event("track");o.track=r.track,o.receiver=n,o.transceiver={receiver:n},o.streams=[t.stream],this.dispatchEvent(o)}),t.stream.getTracks().forEach(r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===r.id):{track:r};const o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=[t.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else M(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function B(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let o=r.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function K(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,n]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const o=function(e){const t={};return e.result().forEach(e=>{const r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{r[t]=e.stat(t)}),t[r.id]=r}),t},i=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const n=function(e){r(i(o(e)))};return t.apply(this,[n,e])}return new Promise((e,r)=>{t.apply(this,[function(t){e(i(o(t)))},r])}).then(r,n)}}function H(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>V(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),M(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>V(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,r,n;return this.getSenders().forEach(r=>{r.track===e&&(t?n=!0:t=r)}),this.getReceivers().forEach(t=>(t.track===e&&(r?n=!0:r=t),t.track===e)),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Z(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();r.apply(this,arguments);const n=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),o.apply(this,arguments)}}function Y(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Z(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}n.apply(this,[t])};const o=e.RTCPeerConnection.prototype.removeStream;function i(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(o.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}function s(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),o.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const o=this.getSenders().find(e=>e.track===t);if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[r.id];if(i)i.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const n=new e.MediaStream([t]);this._streams[r.id]=n,this._reverseStreams[n.id]=r,this.addStream(n)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[t=>{const r=i(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then(e=>i(this,e))}};e.RTCPeerConnection.prototype[t]=n[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=s(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:i(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(r=>{this._streams[r].getTracks().find(t=>e.track===t)&&(t=this._streams[r])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function X(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}))}function Q(e,t){M(e,"negotiationneeded",e=>{const r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e})}function ee(e,t){const r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){F("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"==typeof r&&"object"==typeof r.audio&&(r=JSON.parse(JSON.stringify(r)),e(r.audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"==typeof r&&(r=JSON.parse(JSON.stringify(r)),e(r,"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function te(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function re(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ne(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}));const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,o,i]=arguments;return n.apply(this,[e||null]).then(e=>{if(t.version<53&&!o)try{e.forEach(e=>{e.type=r[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,n)=>{e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))})}return e}).then(o,i)}}function oe(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ie(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),M(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function se(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){F("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function ae(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ce(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const r=e.length>0;r&&e.forEach(e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const n=t.apply(this,arguments);if(r){const{sender:t}=n,r=t.getParameters();(!("encodings"in r)||1===r.encodings.length&&0===Object.keys(r.encodings[0]).length)&&(r.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(r).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return n})}function ue(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function de(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function pe(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function le(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(r=>t.call(this,r,e)),e.getVideoTracks().forEach(r=>t.call(this,r,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const r=e.getTracks();this.getSenders().forEach(e=>{r.includes(e.track)&&this.removeTrack(e)})})}}function fe(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const r=new Event("addstream");r.stream=t,e.dispatchEvent(r)})}),t.apply(e,arguments)}}}function he(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,o=t.setLocalDescription,i=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o};let a=function(e,t,r){const n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=a,a=function(e,t,r){const n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=a,a=function(e,t,r){const n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=a}function me(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(ve(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function ve(e){return e&&void 0!==e.video?Object.assign({},e,{video:z(e.video)}):e}function ge(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){const t=[];for(let r=0;r<e.iceServers.length;r++){let n=e.iceServers[r];void 0===n.urls&&n.url?(F("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function ye(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function be(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const r=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function _e(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Ce=r(4),we=r.n(Ce);function Se(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const r=new t(e),n=we.a.parseCandidate(e.candidate);for(const e in n)e in r||Object.defineProperty(r,e,{value:n[e]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,M(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function xe(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||M(e,"icecandidate",e=>{if(e.candidate){const t=we.a.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function Te(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const r=function(e){if(!e||!e.sdp)return!1;const t=we.a.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=we.a.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},n=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const r=parseInt(t[1],10);return r!=r?-1:r},o=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},i=function(e,r){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const o=we.a.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?n=parseInt(o[0].substring(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const e=n(arguments[0]),t=o(e),r=i(arguments[0],e);let s;s=0===t&&0===r?Number.POSITIVE_INFINITY:0===t||0===r?Math.max(t,r):Math.min(t,r);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>s}),this._sctp=a}return s.apply(this,arguments)}}function ke(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const r=e.send;e.send=function(){const n=arguments[0],o=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=r.apply(this,arguments);return t(e,this),e},M(e,"datachannel",e=>(t(e.channel,e.target),e))}function Re(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Ee(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const r=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function Pe(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Oe(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return r.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return r.apply(this,[e]);const t="offer"===e.type?this.createOffer:this.createAnswer;return t.apply(this).then(e=>r.apply(this,[e]))})}var Ie=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=A,a=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=D(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=D(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=D(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),c={browserDetails:a,commonShim:s,extractVersion:D,disableLog:L,disableWarnings:N,sdp:Ce};switch(a.browser){case"chrome":if(!n||!X||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),c;if(null===a.version)return r("Chrome shim can not determine version, not shimming."),c;r("adapter.js shimming chrome."),c.browserShim=n,Pe(e,a),Oe(e),G(e,a),W(e),X(e,a),$(e),Y(e,a),B(e),K(e),H(e),Q(e,a),Se(e),xe(e),Re(e),Te(e,a),ke(e),Ee(e,a);break;case"firefox":if(!o||!ne||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=o,Pe(e,a),Oe(e),ee(e,a),ne(e,a),re(e),se(e),oe(e),ie(e),ae(e),ce(e),ue(e),de(e),pe(e),Se(e),Re(e),Te(e,a),ke(e);break;case"safari":if(!i||!t.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=i,Pe(e,a),Oe(e),ge(e),be(e),he(e),le(e),fe(e),ye(e),me(e),_e(e),Se(e),xe(e),Te(e,a),ke(e),Ee(e,a);break;default:r("Unsupported browser!")}return c}({window:"undefined"==typeof window?void 0:window});function je(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return De(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return De(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}function De(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Me(){return console.log("######## webrtc detect browers: "+JSON.stringify(Ie.browserDetails)),Ie.browserDetails}function Le(){try{if(window.RTCPeerConnection)return new RTCPeerConnection({iceServers:[{urls:"stun:stun.stunprotocol.org:3478"}]}),!0;throw"å½åæµè§å¨ä¸æ¯æè¯¥åè½"}catch(e){return console.error("browser not support webrtc"+e),!1}}function Ne(){return new Promise((function(e,t){var r=[],n=[],o=[];navigator.mediaDevices.enumerateDevices().then((function(e){var t,i=je(e);try{for(i.s();!(t=i.n()).done;){var s=t.value;"videoinput"===s.kind?r.push(s):"audioinput"===s.kind?n.push(s):"audiooutput"===s.kind&&o.push(s)}}catch(e){i.e(e)}finally{i.f()}})).then((function(){e({videoDevices:r,audioDevices:n,audioOutputDevices:o})}))}))}var Ae={FRAME_RATE_ENUM_5:0,FRAME_RATE_ENUM_10:1,FRAME_RATE_ENUM_15:2,FRAME_RATE_ENUM_20:3,FRAME_RATE_ENUM_25:4,FRAME_RATE_ENUM_30:5,FRAME_RATE_ENUM_NORMAL:2},Fe={VIDEO_RESOLUTION_ENUM_120P:0,VIDEO_RESOLUTION_ENUM_240P:1,VIDEO_RESOLUTION_ENUM_360P:2,VIDEO_RESOLUTION_ENUM_480P:3,VIDEO_RESOLUTION_ENUM_540P:4,VIDEO_RESOLUTION_ENUM_720P:5,VIDEO_RESOLUTION_ENUM_1080P:6,VIDEO_RESOLUTION_ENUM_NORMAL:6};function Ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ze(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(r),!0).forEach((function(t){d()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=x()(e);if(t){var o=x()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return w()(this,r)}}var Je={0:{width:{ideal:160},height:{ideal:120}},1:{width:{ideal:320},height:{ideal:240}},2:{width:{ideal:480},height:{ideal:360}},3:{width:{ideal:640},height:{ideal:480}},4:{width:{ideal:960},height:{ideal:540}},5:{width:{ideal:1280},height:{ideal:720}},6:{width:{ideal:1920},height:{ideal:1080}}},Ge={0:{frameRate:{ideal:5,max:5}},1:{frameRate:{ideal:10,max:10}},2:{frameRate:{ideal:15,max:15}},3:{frameRate:{ideal:20,max:20}},4:{frameRate:{ideal:25,max:25}},5:{frameRate:{ideal:30,max:30}}};window.AudioContext=window.AudioContext||window.webkitAudioContext;var qe=function(){function e(){v()(this,e),this._audioContext=new AudioContext,this._gainNode=this._audioContext.createGain(),this._audioSource,this._audioDestination}return y()(e,[{key:"init",value:function(e){this._audioSource=this._audioContext.createMediaStreamSource(e),this._audioDestination=this._audioContext.createMediaStreamDestination(),this._audioSource.connect(this._gainNode),this._gainNode.connect(this._audioDestination)}},{key:"changeMicrophoneLevel",value:function(e){e&&e>=0&&e<=5&&(this._gainNode.gain.value=e)}}]),e}(),We=1,$e=2,Be=function(e){_()(n,e);var t,r=Ve(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$e;return v()(this,n),(e=r.call(this))._streamDirection=i,e._uid=null,e._mid=t,e._sfuid=null,e._sid=null,e._minfo={},e._stream=o,e._videoElement=null,e._videoDeviceId=null,e}return y()(n,[{key:"init",value:(t=h()(k.a.mark((function e(){var t,r,n,o,i,s,a,c,u,d,p,l=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.length>0&&void 0!==l[0]&&l[0],r=l.length>1&&void 0!==l[1]?l[1]:{audio:!0,video:!0,screen:!1,resolution:Fe.VIDEO_RESOLUTION_ENUM_NORMAL,frameRate:Ae.FRAME_RATE_ENUM_NORMAL,audioDeviceId:null,videoDeviceId:null},console.log("Stream init ---- options: "+r),!t){e.next=39;break}return e.next=6,Ne();case 6:if(n=e.sent,this._streamDirection=We,!r.screen){e.next=14;break}return e.next=11,navigator.mediaDevices.getDisplayMedia(ze({video:!0},Ge[r.frameRate]));case 11:this._stream=e.sent,e.next=38;break;case 14:if(!r.audio||!r.video){e.next=24;break}return o={deviceId:""},n.audioDevices.length>0&&(null!=r.audioDeviceId?(i=n.audioDevices.find((function(e){return e.deviceId==r.audioDeviceId})),o=i?{deviceId:r.audioDeviceId}:{deviceId:n.audioDevices[0].deviceId}):o={deviceId:n.audioDevices[0].deviceId}),s=ze(ze({deviceId:""},Je[r.resolution]),Ge[r.frameRate]),n.videoDevices.length>0&&(null!=r.videoDeviceId?(a=n.videoDevices.find((function(e){return e.deviceId==r.videoDeviceId})),s.deviceId=a?r.videoDeviceId:n.videoDevices[0].deviceId):s.deviceId=n.videoDevices[0].deviceId),e.next=21,navigator.mediaDevices.getUserMedia({audio:o,video:s});case 21:this._stream=e.sent,e.next=38;break;case 24:if(!r.audio){e.next=33;break}return c={deviceId:""},n.audioDevices.length>0&&(null!=r.audioDeviceId?(u=n.audioDevices.find((function(e){return e.deviceId==r.audioDeviceId})),c=u?{deviceId:r.audioDeviceId}:{deviceId:n.audioDevices[0].deviceId}):c={deviceId:n.audioDevices[0].deviceId}),console.log("Stream init ---- audioOptions: "+String(c)),e.next=30,navigator.mediaDevices.getUserMedia({audio:c});case 30:this._stream=e.sent,e.next=38;break;case 33:return d=ze(ze({deviceId:""},Je[r.resolution]),Ge[r.frameRate]),n.videoDevices.length>0&&(null!=r.videoDeviceId?(p=n.videoDevices.find((function(e){return e.deviceId==r.videoDeviceId})),d.deviceId=p?r.videoDeviceId:n.videoDevices[0].deviceId):d.deviceId=n.videoDevices[0].deviceId,this._videoDeviceId=d.deviceId),e.next=37,navigator.mediaDevices.getUserMedia({video:d});case 37:this._stream=e.sent;case 38:r.audio&&this._processAudioPubStream();case 39:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"mid",get:function(){return this._mid},set:function(e){this._mid=e}},{key:"stream",get:function(){return this._stream}},{key:"sfuid",get:function(){return this._sfuid},set:function(e){this._sfuid=e}},{key:"sid",get:function(){return this._sid},set:function(e){this._sid=e}},{key:"uid",get:function(){return this._uid},set:function(e){this._uid=e}},{key:"minfo",get:function(){return this._minfo},set:function(e){this._minfo=e}},{key:"streamDirection",get:function(){return this._streamDirection}},{key:"render",value:function(e){this._videoElement||(this._videoElement=new O),this._videoElement.play({id:this._mid,stream:this._stream,elementId:e,remote:this._streamDirection==$e})}},{key:"stopRender",value:function(){this._videoElement.stop(),this._videoElement=null}},{key:"_processAudioPubStream",value:function(){this._stream&&(this._micro=new qe,this._micro.init(this._stream))}},{key:"getRenderParentElementId",value:function(){return this._videoElement?this._videoElement.parentElementId:null}},{key:"setMicrophoneVolume",value:function(e){this._micro&&this._micro.changeMicrophoneLevel(e)}},{key:"getAudioMuteState",value:function(){return this._stream.getAudioTracks().forEach((function(e){return!e.enabled})),!1}},{key:"setMuteAudio",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._stream.getAudioTracks(),r=!1;return t.forEach((function(t){t.enabled=!e,r=!0})),r}},{key:"setMuteVideo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._stream.getVideoTracks(),r=!1;return t.forEach((function(t){t.enabled=!e,r=!0})),r}}]),n}(R.EventEmitter),Ke=r(14),He=new Map([[1e4,{name:"ServerInternalError",message:"Service internal error"}],[10005,{name:"UidParamError",message:"uid param error"}],[10100,{name:"NotInRoom",message:"User not in the room"}],[10101,{name:"LevelRoomServerError",message:"The Level failed and the server returned an error"}],[10101,{name:"JoinParamError",message:"Join room parameter error"}],[10200,{name:"DeviceNotExist",message:"The deviceId does not exist"}],[10201,{name:"NewDeviceNotExist",message:"No new devices were found"}],[10300,{name:"AudioStreamExistError",message:"The audio push stream already exists"}],[10301,{name:"AudioStreamNotExistError",message:"The audio push stream not exists"}],[10302,{name:"VideoStreamExistError",message:"The video push stream already exists"}],[10303,{name:"VideoStreamNotExistError",message:"The video push stream not exists"}],[10304,{name:"ScreenStreamExistError",message:"The screen push stream already exists"}],[10305,{name:"ScreenStreamNotExistError",message:"The screen push stream not exists"}],[10310,{name:"UidNotStream",message:"This user has not published a stream"}],[10311,{name:"UidNotSubStream",message:"There is no subscription to this user's stream"}],[10312,{name:"SubFailedServerError",message:"The subscription failed and the server returned an error"}],[10313,{name:"UnSubFailedServerError",message:"The unsubscription failed and the server returned an error"}],[10314,{name:"BroadcastFailedServerError",message:"The broadcast failed and the server returned an error"}],[10315,{name:"KeepaliveServerError",message:"The Keepalive failed and the server returned an error"}]]),Ze=y()((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";v()(this,e),this.code=t,this.name=r,this.message="",this.serverErrorDesc="",He.has(t)&&(this.name=He.get(t).name,this.message=He.get(t).message),console.log("serverError: "+n),(n=String(n)).length>0&&(this.isServerError=!0,this.serverErrorDesc=n)}));function Ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(r),!0).forEach((function(t){d()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ye(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Qe(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return et(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return et(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function tt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=x()(e);if(t){var o=x()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return w()(this,r)}}var rt=1,nt=2,ot=3;console.log("######## webrtc detect browers: "+JSON.stringify(Ie.browserDetails));var it=function(e){_()(O,e);var t,r,n,o,i,s,a,c,u,d,p,f,m,g,b,C,w,S,x,T,R,E=tt(O);function O(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8443;return v()(this,O),e=E.call(this),null==r&&(e._hostname=window.location.hostname),e._useWSS=t,e._hostname=r,e._port=n,e._uid=0,e._pcs=new Map,e._streams=new Map,e._publishStreams=new Map,e._ableSubStreamInfo=new Map,e._rid=null,e.keepaliveTimer=null,e._isIgnoreCancelError=!1,e._videoResolution=Fe.VIDEO_RESOLUTION_ENUM_NORMAL,e._videoFrameRate=Ae.FRAME_RATE_ENUM_NORMAL,e._screenFrameRate=Ae.FRAME_RATE_ENUM_NORMAL,e}return y()(O,[{key:"uid",get:function(){return this._uid}},{key:"rid",get:function(){return this._rid}},{key:"isIgnoreCancelError",set:function(e){this._isIgnoreCancelError=e}},{key:"init",value:function(e){var t=this;this._uid=e,this._url=this._getProtooUrl(this._uid),console.log('Peer "init" - url:'+this._url),console.log("adapter.browserDetails.browser:"+Ie.browserDetails.browser);var r=new P.a.WebSocketTransport(this._url,{});this._protoo=new P.a.Peer(r),this._protoo.on("open",(function(){console.log('Peer "open" event'),t.emit("transport-open")})),this._protoo.on("connected",(function(){console.log('Peer "connected" event')})),this._protoo.on("failed",(function(e){console.log('Peer "failed" event - '+e),t.emit("failed")})),this._protoo.on("disconnected",(function(){console.log('Peer "disconnected" event'),t.emit("transport-failed")})),this._protoo.on("close",(function(){console.log('Peer "close" event'),t.emit("transport-closed")})),this._protoo.on("request",this._handleRequest.bind(this)),this._protoo.on("notification",this._handleNotification.bind(this))}},{key:"join",value:(R=h()(k.a.mark((function e(t){var r,n=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject(new Ze(10101,"JoinParamError")));case 2:return e.prev=2,e.next=5,this._protoo.request("join",{rid:t});case 5:return r=e.sent,console.log("join success: result => "+JSON.stringify(r)),this._rid=t,r.pubs.forEach((function(e){n._ableSubStreamInfo.set(e.mid,e)})),this.keepaliveTimer&&clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){n._keepalive()}),2e4),e.abrupt("return",r);case 14:return e.prev=14,e.t0=e.catch(2),console.log("join reject: error =>"+e.t0),e.abrupt("return",Promise.reject(new Ze(1e4,"ServerInternalError",e.t0)));case 18:case"end":return e.stop()}}),e,this,[[2,14]])}))),function(e){return R.apply(this,arguments)})},{key:"leave",value:(T=h()(k.a.mark((function e(){var t,r,n,o,i,s,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._rid){e.next=2;break}return e.abrupt("return",Promise.reject(new Ze(10100,"NotInRoom")));case 2:e.prev=2,t=Qe(this._publishStreams.values()),e.prev=4,t.s();case 6:if((r=t.n()).done){e.next=12;break}return n=r.value,e.next=10,this.unpublish(n.mid);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),t.e(e.t0);case 17:return e.prev=17,t.f(),e.finish(17);case 20:o=Qe(this._streams.values()),e.prev=21,o.s();case 23:if((i=o.n()).done){e.next=29;break}return s=i.value,e.next=27,this.unsubscribe(s.mid);case 27:e.next=23;break;case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(21),o.e(e.t1);case 34:return e.prev=34,o.f(),e.finish(34);case 37:return this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),e.next=40,this._protoo.request("leave",{rid:this._rid});case 40:a=e.sent,console.log("leave success: result => "+JSON.stringify(a)),e.next=49;break;case 44:if(e.prev=44,e.t2=e.catch(2),console.log("leave reject: error =>"+e.t2),this._isIgnoreCancelError){e.next=49;break}return e.abrupt("return",Promise.reject(new Ze(10101,"LevelRoomServerError",e.t2)));case 49:return e.prev=49,this._rid=null,e.finish(49);case 52:case"end":return e.stop()}}),e,this,[[2,44,49,52],[4,14,17,20],[21,31,34,37]])}))),function(){return T.apply(this,arguments)})},{key:"setAudioPublish",value:(x=h()(k.a.mark((function e(t){var r,n,o=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:null,!t){e.next=9;break}if(!this._publishStreams.has(rt)){e.next=4;break}return e.abrupt("return",Promise.reject(new Ze(10300,"AudioStreamExistError")));case 4:return e.next=6,this.publish({audio:!0,audioDeviceId:r});case 6:return e.abrupt("return",e.sent);case 9:if(this._publishStreams.has(rt)){e.next=11;break}return e.abrupt("return",Promise.reject(new Ze(10301,"AudioStreamNotExistError")));case 11:return n=this._publishStreams.get(rt),this._publishStreams.delete(rt),e.next=15,this.unpublish(n.mid);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"setVideoPublish",value:(S=h()(k.a.mark((function e(t){var r,n,o=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:null,!t){e.next=9;break}if(!this._publishStreams.has(nt)){e.next=4;break}return e.abrupt("return",Promise.reject(new Ze(10302,"VideoStreamExistError")));case 4:return e.next=6,this.publish({video:!0,resolution:this._videoResolution,frameRate:this._videoFrameRate,videoDeviceId:r});case 6:return e.abrupt("return",e.sent);case 9:if(this._publishStreams.has(nt)){e.next=11;break}return e.abrupt("return",Promise.reject(new Ze(10303,"VideoStreamNotExistError")));case 11:return n=this._publishStreams.get(nt),this._publishStreams.delete(nt),e.next=15,this.unpublish(n.mid);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"SwitchVideo",value:(w=h()(k.a.mark((function e(){var t,r,n,o,i,s,a=this,c=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:null,this._publishStreams.has(nt)){e.next=3;break}return e.abrupt("return",Promise.reject(new Ze(10303,"VideoStreamNotExistError")));case 3:return e.next=5,Ne();case 5:if(r=e.sent,n=null,null==t){e.next=13;break}if(n=r.videoDevices.find((function(e){return e.deviceId==t}))){e.next=11;break}return e.abrupt("return",Promise.reject(new Ze(10200,"DeviceNotExist")));case 11:e.next=16;break;case 13:if(n=r.videoDevices.find((function(e){return e.deviceId!=a._publishStreams.get(nt)._videoDeviceId}))){e.next=16;break}return e.abrupt("return",Promise.reject(new Ze(10201,"NewDeviceNotExist")));case 16:if(!n){e.next=29;break}return console.log("old videoDeviceId: "+this._publishStreams.get(nt)._videoDeviceId+"new: "+n.deviceId),o=this._publishStreams.get(nt),(i=o.getRenderParentElementId())&&o.stop(),e.next=23,this.unpublish(o.mid);case 23:return this._publishStreams.delete(nt),e.next=26,this.publish({video:!0,resolution:this._videoResolution,frameRate:this._videoFrameRate,videoDeviceId:n.deviceId});case 26:return s=e.sent,i&&s.render(i),e.abrupt("return",s);case 29:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"setVideoPubResolutionFrame",value:function(e,t){Fe[e]&&(this._videoResolution=Fe[e]),Ae[t]&&(this._videoFrameRate=Ae[t])}},{key:"setScreenPublish",value:(C=h()(k.a.mark((function e(t){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}if(!this._publishStreams.has(ot)){e.next=3;break}return e.abrupt("return",Promise.reject(new Ze(10304,"ScreenStreamExistError")));case 3:return e.next=5,this.publish({screen:!0,frameRate:this._screenFrameRate});case 5:return e.abrupt("return",e.sent);case 8:if(this._publishStreams.has(ot)){e.next=10;break}return e.abrupt("return",Promise.reject(new Ze(10305,"ScreenStreamNotExistError")));case 10:return r=this._publishStreams.get(ot),this._publishStreams.delete(ot),e.next=14,this.unpublish(r.mid);case 14:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"setScreenPubFrame",value:function(e){Ae[e]&&(this._screenFrameRate=Ae[e])}},{key:"setAudioSub",value:(b=h()(k.a.mark((function e(t){var r,n,o,i,s,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject(new Ze(10005,"UidParamError")));case 2:r=null,n=Qe(this._ableSubStreamInfo),e.prev=4,n.s();case 6:if((o=n.n()).done){e.next=13;break}if(i=l()(o.value,2),s=i[0],(a=i[1]).uid!=t||!a.minfo.audio){e.next=11;break}return r=s,e.abrupt("break",13);case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:if(!r){e.next=27;break}return e.next=24,this.subscribe(r,t);case 24:return e.abrupt("return",e.sent);case 27:return e.abrupt("return",Promise.reject(new Ze(10310,"UidNotStream")));case 28:case"end":return e.stop()}}),e,this,[[4,15,18,21]])}))),function(e){return b.apply(this,arguments)})},{key:"setAudioUnSub",value:(g=h()(k.a.mark((function e(t){var r,n,o,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject(new Ze(10005,"UidParamError")));case 2:r=null,n=Qe(this._streams.values()),e.prev=4,n.s();case 6:if((o=n.n()).done){e.next=13;break}if((i=o.value).uid!=t||!i.stream.getAudioTracks()){e.next=11;break}return r=i.mid,e.abrupt("break",13);case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:if(!r){e.next=27;break}return e.next=24,this.unsubscribe(r);case 24:return e.abrupt("return",e.sent);case 27:return e.abrupt("return",Promise.reject(new Ze(10311,"UidNotSubStream")));case 28:case"end":return e.stop()}}),e,this,[[4,15,18,21]])}))),function(e){return g.apply(this,arguments)})},{key:"setVideoSub",value:(m=h()(k.a.mark((function e(t){var r,n,o,i,s,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject(new Ze(10005,"UidParamError")));case 2:r=null,n=Qe(this._ableSubStreamInfo),e.prev=4,n.s();case 6:if((o=n.n()).done){e.next=13;break}if(i=l()(o.value,2),s=i[0],(a=i[1]).uid!=t||!a.minfo.video||0!=a.minfo.videotype){e.next=11;break}return r=s,e.abrupt("break",13);case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:if(!r){e.next=27;break}return e.next=24,this.subscribe(r,t);case 24:return e.abrupt("return",e.sent);case 27:return e.abrupt("return",Promise.reject(new Ze(10310,"UidNotStream")));case 28:case"end":return e.stop()}}),e,this,[[4,15,18,21]])}))),function(e){return m.apply(this,arguments)})},{key:"setVideoUnSub",value:(f=h()(k.a.mark((function e(t){var r,n,o,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject(new Ze(10005,"UidParamError")));case 2:r=null,n=Qe(this._streams.values()),e.prev=4,n.s();case 6:if((o=n.n()).done){e.next=13;break}if((i=o.value).uid!=t||!i.minfo.video||0!=i.minfo.videotype){e.next=11;break}return r=i.mid,e.abrupt("break",13);case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:if(!r){e.next=27;break}return e.next=24,this.unsubscribe(r);case 24:return e.abrupt("return",e.sent);case 27:return e.abrupt("return",Promise.reject(new Ze(10311,"UidNotSubStream")));case 28:case"end":return e.stop()}}),e,this,[[4,15,18,21]])}))),function(e){return f.apply(this,arguments)})},{key:"setScreenSub",value:(p=h()(k.a.mark((function e(t){var r,n,o,i,s,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject(new Ze(10005,"UidParamError")));case 2:r=null,n=Qe(this._ableSubStreamInfo),e.prev=4,n.s();case 6:if((o=n.n()).done){e.next=13;break}if(i=l()(o.value,2),s=i[0],(a=i[1]).uid!=t||!a.minfo.video||1!=a.minfo.videotype){e.next=11;break}return r=s,e.abrupt("break",13);case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:if(!r){e.next=27;break}return e.next=24,this.subscribe(r,t);case 24:return e.abrupt("return",e.sent);case 27:return e.abrupt("return",Promise.reject(new Ze(10310,"UidNotStream")));case 28:case"end":return e.stop()}}),e,this,[[4,15,18,21]])}))),function(e){return p.apply(this,arguments)})},{key:"setScreenUnSub",value:(d=h()(k.a.mark((function e(t){var r,n,o,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject(new Ze(10005,"UidParamError")));case 2:r=null,n=Qe(this._streams.values()),e.prev=4,n.s();case 6:if((o=n.n()).done){e.next=13;break}if((i=o.value).uid!=t||!i.minfo.video||1!=i.minfo.videotype){e.next=11;break}return r=i.mid,e.abrupt("break",13);case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:if(!r){e.next=27;break}return e.next=24,this.unsubscribe(r);case 24:return e.abrupt("return",e.sent);case 27:return e.abrupt("return",Promise.reject(new Ze(10311,"UidNotSubStream")));case 28:case"end":return e.stop()}}),e,this,[[4,15,18,21]])}))),function(e){return d.apply(this,arguments)})},{key:"publish",value:(u=h()(k.a.mark((function e(){var t,r,n=this,o=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{audio:!1,video:!1,screen:!1,codec:"h264",resolution:Fe.VIDEO_RESOLUTION_ENUM_NORMAL,frameRate:Ae.FRAME_RATE_ENUM_NORMAL,audioDeviceId:null,videoDeviceId:null},console.log("publish options => %o",t),r=new Promise(function(){var e=h()(k.a.mark((function e(r,o){var i,s;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null,e.prev=1,(s=new Be).uid=n._uid,e.next=6,s.init(!0,{audio:t.audio,video:t.video,screen:t.screen,resolution:t.resolution,frameRate:t.frameRate,videoDeviceId:t.videoDeviceId,audioDeviceId:t.audioDeviceId});case 6:return e.next=8,n._createSender(s.stream,t.codec);case 8:(i=e.sent).onicecandidate=function(){var e=h()(k.a.mark((function e(o){var a,c,u,d;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.sendOffer){e.next=20;break}return a=i.localDescription,console.log("Send offer sdp => "+a.sdp),i.sendOffer=!0,c={},t.audio&&(c.audio=!0,c.audiotype=0),u={},t.video?(u.video=!0,u.videotype=0):t.screen&&(u.video=!0,u.videotype=1),e.next=10,n._protoo.request("publish",{rid:n._rid,jsep:a,minfo:Xe(Xe({},c),u)});case 10:return d=e.sent,e.next=13,i.setRemoteDescription(d.jsep);case 13:console.log("publish success => "+JSON.stringify(d)),s.mid=d.mid,s.sfuid=d.sfuid,s.minfo=Xe(Xe({},c),u),n._pcs.set(s.mid,i),t.audio?n._publishStreams.set(rt,s):t.video?n._publishStreams.set(nt,s):t.screen?n._publishStreams.set(ot,s):console.log("imposibile"),r(s);case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(1),console.log("publish request error  => "+e.t0),i&&i.close(),o(new Ze(1e4,"ServerInternalError",e.t0));case 17:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t,r){return e.apply(this,arguments)}}()),e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)})},{key:"unpublish",value:(c=h()(k.a.mark((function e(t){var r,n,o,i,s,a,c;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("unpublish rid => %s, mid => %s",this._rid,t),r=null,n=Qe(this._publishStreams),e.prev=3,n.s();case 5:if((o=n.n()).done){e.next=12;break}if(i=l()(o.value,2),s=i[0],i[1].mid!=t){e.next=10;break}return r=s,e.abrupt("break",12);case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:if(r){e.next=22;break}return e.abrupt("return");case 22:return a=this._publishStreams.get(r).sfuid,this._removePC(t),e.prev=24,e.next=27,this._protoo.request("unpublish",{rid:this._rid,mid:t,sfuid:a});case 27:c=e.sent,console.log("unpublish success: result => "+JSON.stringify(c)),e.next=36;break;case 31:if(e.prev=31,e.t1=e.catch(24),console.log("unpublish reject: error =>"+e.t1),this._isIgnoreCancelError){e.next=36;break}return e.abrupt("return",Promise.reject(new Ze(1e4,"ServerInternalError",e.t1)));case 36:case"end":return e.stop()}}),e,this,[[3,14,17,20],[24,31]])}))),function(e){return c.apply(this,arguments)})},{key:"subscribe",value:(a=h()(k.a.mark((function e(t,r){var n,o,i=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._rid){e.next=2;break}return e.abrupt("return",Promise.reject(new Ze(10100,"NotInRoom")));case 2:return n=this._rid,console.log("subscribe rid => %s, mid => %a",n,t),o=new Promise(function(){var e=h()(k.a.mark((function e(o,s){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i._createReceiver(t);case 3:(a=e.sent).ontrack=function(e){console.log("Stream::pc::onaddstream---"+e),i._streams.has(t)&&i._streams.get(t).stream.addTrack(e.track),1==i._streams.get(t).stream.getTracks().length&&(i._ableSubStreamInfo.delete(t),o(i._streams.get(t)))},a.onaddstream=function(e){var t=e.stream;console.log("Stream::pc::onaddstream",t.id)},a.onremovestream=function(e){var t=e.stream;console.log("Stream::pc::onremovestream",t.id)},a.onicecandidate=function(){var e=h()(k.a.mark((function e(o){var c,u,d;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.sendOffer||(c=a.localDescription,a.sendOffer=!0,u=0,(d=function(){var e=h()(k.a.mark((function e(){var o,p,l,f;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("subscribe request time:"+(new Date).getTime()+" retry: "+u),e.next=4,i._protoo.request("subscribe",{rid:n,jsep:c,mid:t});case 4:return o=e.sent,p=i._ableSubStreamInfo.get(t).minfo,l=new MediaStream,(f=new Be(t,l)).sfuid=o.sfuid,f.sid=o.sid,f.uid=r,f.minfo=p,i._streams.set(t,f),console.log("subscribe success => result("+t+") sid: "+o.sid+" sdp => "+o.jsep.sdp),e.next=16,a.setRemoteDescription(o.jsep);case 16:e.next=23;break;case 18:e.prev=18,e.t0=e.catch(0),console.log("subscribe request error  => "+e.t0),++u<10?setTimeout(d,1e3):(i._streams.delete(t),s(new Ze(10312,"SubFailedServerError",e.t0)));case 23:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}())());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(0),console.log("subscribe request error  => "+e.t0),i._streams.delete(t),s(new Ze(10312,"SubFailedServerError",e.t0));case 15:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r){return e.apply(this,arguments)}}()),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"unsubscribe",value:(s=h()(k.a.mark((function e(t){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("unsubscribe rid => %s, mid => %s ",this._rid,t),this._rid){e.next=3;break}return e.abrupt("return",Promise.reject(new Ze(10100,"NotInRoom")));case 3:return e.prev=3,console.log("unsubscribe - sfuid: "+this._streams.get(t).sfuid+"sid: "+this._streams.get(t).sid),e.next=7,this._protoo.request("unsubscribe",{rid:this._rid,mid:t,sid:this._streams.get(t).sid,sfuid:this._streams.get(t).sfuid});case 7:r=e.sent,console.log("unsubscribe success: result => "+JSON.stringify(r)),e.next=16;break;case 11:if(e.prev=11,e.t0=e.catch(3),console.log("unsubscribe reject: error =>"+e.t0),this._isIgnoreCancelError){e.next=16;break}return e.abrupt("return",Promise.reject(new Ze(10313,"UnSubFailedServerError",e.t0)));case 16:return e.prev=16,this._removePC(t),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[3,11,16,19]])}))),function(e){return s.apply(this,arguments)})},{key:"broadcast",value:(i=h()(k.a.mark((function e(t){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("broadcast rid => %s, data => %s",this._rid,t),this._rid){e.next=3;break}return e.abrupt("return",Promise.reject(new Ze(10100,"NotInRoom")));case 3:return e.prev=3,e.next=6,this._protoo.request("broadcast",{rid:this._rid,data:r});case 6:return r=e.sent,console.log("broadcast success: result => "+JSON.stringify(r)),e.abrupt("return",r);case 11:return e.prev=11,e.t0=e.catch(3),console.log("broadcast reject: error =>"+e.t0),e.abrupt("return",Promise.reject(new Ze(10314,"BroadcastFailedServerError",e.t0)));case 15:case"end":return e.stop()}}),e,this,[[3,11]])}))),function(e){return i.apply(this,arguments)})},{key:"_keepalive",value:(o=h()(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("keepalive rid => %s",this._rid),this._rid){e.next=3;break}return e.abrupt("return",Promise.reject(new Ze(10100,"NotInRoom")));case 3:return e.prev=3,e.next=6,this._protoo.request("keepalive",{rid:this._rid});case 6:t=e.sent,console.log("keepalive success: result => "+JSON.stringify(t)),e.next=15;break;case 10:if(e.prev=10,e.t0=e.catch(3),console.log("keepalive reject: error =>"+e.t0),this._isIgnoreCancelError){e.next=15;break}return e.abrupt("return",Promise.reject(new Ze(10315,"KeepaliveServerError",e.t0)));case 15:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(){return o.apply(this,arguments)})},{key:"close",value:(n=h()(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._rid){e.next=4;break}return e.next=3,this.leave();case 3:this._rid=null;case 4:this._protoo.close();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_payloadModify",value:function(e,t){if(void 0===t)return e;var r,n="",o=Ke.parse(e.sdp);console.log("SDP object => %o",o);var i=-1;if(o.media.map((function(e,t){"video"==e.type&&(i=t)})),-1==i)return e;if("vp8"===t.toLowerCase())r=96,n="VP8";else if("vp9"===t.toLowerCase())r=98,n="VP9";else{if("h264"!==t.toLowerCase())return e;r=102,n="H264"}console.log("Setup codec => "+n+", payload => "+r);var s=[{payload:r,codec:n,rate:9e4,encoding:null},{payload:97,codec:"rtx",rate:9e4,encoding:null}];o.media[i].payloads=r+" 97",o.media[i].rtp=s;var a=[{payload:97,config:"apt="+r}];o.media[i].fmtp=a;var c=[{payload:r,type:"transport-cc",subtype:null},{payload:r,type:"ccm",subtype:"fir"},{payload:r,type:"nack",subtype:null},{payload:r,type:"nack",subtype:"pli"}];o.media[i].rtcpFb=c;var u=e;return u.sdp=Ke.write(o),u}},{key:"_createSender",value:(r=h()(k.a.mark((function e(t,r){var n,o,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create sender => %s",r),(n=new RTCPeerConnection({iceServers:[{urls:"stun:stun.stunprotocol.org:3478"}]})).sendOffer=!1,t.getTracks().forEach((function(e){n.addTrack(e,t)})),e.next=6,n.createOffer({offerToReceiveVideo:!1,offerToReceiveAudio:!1});case 6:return o=e.sent,i=this._payloadModify(o,r),n.setLocalDescription(i),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"_createReceiver",value:(t=h()(k.a.mark((function e(t){var r,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create receiver => mid :%s",t),(r=new RTCPeerConnection({iceServers:[{urls:"stun:stun.stunprotocol.org:3478"}]})).sendOffer=!1,r.addTransceiver("audio",{direction:"recvonly"}),r.addTransceiver("video",{direction:"recvonly"}),e.next=7,r.createOffer();case 7:return(n=e.sent).sdp=this._modifyCodec(n.sdp),r.setLocalDescription(n),this._pcs.set(t,r),e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_modifyCodec",value:function(e){var t=e.indexOf("a=rtpmap:96 ")+"a=rtpmap:96 ".length,r=e.slice(t).indexOf("/")+t;return"vp8"!=e.slice(t,r).toLowerCase()?e.slice(0,t)+"VP8"+e.slice(r):e}},{key:"_removePC",value:function(e){var t=this._pcs.get(e);if(t){if(console.log("remove pc mid => %s",e),this._streams.has(e))this._streams.delete(e);else{var r,n=null,o=Qe(this._publishStreams);try{for(o.s();!(r=o.n()).done;){var i=l()(r.value,2),s=i[0];if(i[1].mid==e){n=s;break}}}catch(e){o.e(e)}finally{o.f()}n&&(this._publishStreams.delete(n),console.log("delete: mid: "+e))}t.close(),this._pcs.delete(e)}}},{key:"_getProtooUrl",value:function(e){var t="ws";return this._useWSS&&(t="wss"),"".concat(t,"://").concat(this._hostname,":").concat(this._port,"/ws?peer=").concat(e)}},{key:"_handleRequest",value:function(e,t,r){console.log("Handle request from server: [method:%s, data:%o]",e.method,e.data)}},{key:"_handleNotification",value:function(e){var t=e.method,r=e.data;switch(console.log("Handle notification from server: [method:%s, data:%o]",t,r),t){case"peer-join":var n=r.rid,o=r.uid,i=r.bizid;console.log("peer-join peer rid => %s, uid => %s, bizid => %o",n,o,i),this.emit("peer-join",n,o,i);break;case"peer-leave":var s=r.rid,a=r.uid;console.log("peer-leave peer rid => %s, uid => %s",s,a),this.emit("peer-leave",s,a);break;case"stream-add":var c=r.rid,u=r.uid,d=r.mid,p=r.sfuid,l=r.minfo;console.log("stream-add peer rid => %s, mid => %s",c,d),this._ableSubStreamInfo.set(d,{rid:c,uid:u,mid:d,sfuid:p,minfo:l}),this.emit("stream-add",c,u,d,p,l);break;case"stream-remove":var f=r.rid,h=r.uid,m=r.mid;console.log("stream-remove peer rid => %s, uid =>%s ,mid => %s",f,h,m),this._ableSubStreamInfo.has(m)&&this._ableSubStreamInfo.delete(m),this.emit("stream-remove",f,h,m),this.unsubscribe(m);break;case"broadcast":var v=y.rid,g=y.uid,y=y.data;console.log("stream-remove peer rid => %s, uid => %s",v,g),this.emit("broadcast",v,g,y)}}}]),O}(R.EventEmitter)}])}));
//# sourceMappingURL=ion-sdk.js.map